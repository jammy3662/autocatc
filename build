#!/bin/bash

# leave unmatched wildcards empty
shopt -s nullglob

CLANG_FLAGS="\
-Wno-deprecated -Wunneeded-internal-declaration \
-g3 \
-fno-caret-diagnostics -ferror-limit=999"

mkdir -p generated
cd generated

SRC="../src"

bison -dt \
	$SRC/cat.y \
	--report=states,lookaheads,solved \
	&&

flex --nounput $SRC/cat.l && \

cd ..

unbuffer \
clang++ $CLANG_FLAGS \
	-I src -I generated \
	generated/lex.cat.c \
	generated/cat.tab.c \
	src/*.cc \
	-o autocatc \
	2>&1 \
	| grep -v 'In file included'
